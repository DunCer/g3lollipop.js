!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e(t.g3=t.g3||{},t.d3)}(this,function(t,e){"use strict";function n(t,e){var n=(document.getElementById("canvas")||document.createElement("canvas")).getContext("2d");return n.font=e,n.measureText(t).width}function r(t,e){return t=t||1e5,e=e||1e6-1,Math.floor(Math.random()*(e-t)+t)}e=e&&e.hasOwnProperty("default")?e.default:e;var a={bottlerocket1:["#A42820","#5F5647","#9B110E","#3F5151","#4E2A1E","#550307","#0C1707"],bottlerocket2:["#FAD510","#CB2314","#273046","#354823","#1E1E1E"],rushmore1:["#E1BD6D","#F2300F","#35274A","#EABE94","#0B775E"],royal1:["#899DA4","#C93312","#FAEFD1","#DC863B"],royal2:["#9A8822","#F5CDB4","#F8AFA8","#FDDDA0","#74A089"],zissou1:["#3B9AB2","#78B7C5","#EBCC2A","#E1AF00","#F21A00"],darjeeling1:["#FF0000","#00A08A","#F2AD00","#F98400","#5BBCD6"],darjeeling2:["#ECCBAE","#046C9A","#D69C4E","#ABDDDE","#000000"],chevalier1:["#446455","#FDD262","#D3DDDC","#C7B19C"],fantasticfox1:["#DD8D29","#E2D200","#46ACC8","#E58601","#B40F20"],moonrise1:["#F3DF6C","#CEAB07","#D5D5D3","#24281A"],moonrise2:["#798E87","#C27D38","#CCC591","#29211F"],moonrise3:["#85D4E3","#F4B5BD","#9C964A","#CDC08C","#FAD77B"],cavalcanti1:["#D8B70A","#02401B","#A2A475","#81A88D","#972D15"],grandbudapest1:["#F1BB7B","#FD6467","#5B1A18","#D67236"],grandbudapest2:["#E6A0C4","#C6CDF7","#D8A499","#7294D4"],google16:["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac"],google5:["#008744","#0057e7","#d62d20","#ffa700","#ffffff"],material1:["#263238","#212121","#3e2723","#dd2c00","#ff6d00","#ffab00","#ffd600","#aeea00","#64dd17","#00c853","#00bfa5","#00b8d4","#0091ea","#2962ff","#304ffe","#6200ea","#aa00ff","#c51162","#d50000"],pie1:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],pie2:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],pie3:["#495769","#A0C2BB","#F4A775","#F4C667","#F37361"],pie4:["#FA7921","#E55934","#9BC53D","#FDE74C","#5BC0EB"],pie5:["#5DA5DA","#4D4D4D","#60BD68","#B2912F","#B276B2","#F15854","#FAA43A"],pie6:["#537ea2","#42a593","#9f1a1a","#7c5f95","#61a070"],pie7:["#bddff9","#1e72bf","#ead1ab","#a2dbc5","#c7ae7d"],breakfast:["#b6411a","#eec3d8","#4182dd","#ecf0c8","#2d6328"],set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],category10:["#1f77b4","#2ca02c","#d62728","#ff7f0e","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"],pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#bf5b17","#386cb0","#f0027f","#666666"],dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]};function o(){return a.google16}function i(t){return t in a?a[t]:o}function l(t){return e.scaleOrdinal(i(t))}var s=s||function(t){if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,n=function(){return t.URL||t.webkitURL||t},r=e.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in r,o=/constructor/i.test(t.HTMLElement)||t.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent),l=t.setImmediate||t.setTimeout,s=function(t){l(function(){throw t},0)},c=function(t){setTimeout(function(){"string"==typeof t?n().revokeObjectURL(t):t.remove()},4e4)},u=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},p=function(e,p,d){d||(e=u(e));var f,m=this,g="application/octet-stream"===e.type,h=function(){!function(t,e,n){for(var r=(e=[].concat(e)).length;r--;){var a=t["on"+e[r]];if("function"==typeof a)try{a.call(t,n||t)}catch(t){s(t)}}}(m,"writestart progress write writeend".split(" "))};if(m.readyState=m.INIT,a)return f=n().createObjectURL(e),void l(function(){var t,e;r.href=f,r.download=p,t=r,e=new MouseEvent("click"),t.dispatchEvent(e),h(),c(f),m.readyState=m.DONE},0);!function(){if((i||g&&o)&&t.FileReader){var r=new FileReader;return r.onloadend=function(){var e=i?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,m.readyState=m.DONE,h()},r.readAsDataURL(e),void(m.readyState=m.INIT)}f||(f=n().createObjectURL(e)),g?t.location.href=f:t.open(f,"_blank")||(t.location.href=f);m.readyState=m.DONE,h(),c(f)}()},d=p.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return e=e||t.name||"download",n||(t=u(t)),navigator.msSaveOrOpenBlob(t,e)}:(d.abort=function(){},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,function(t,e,n){return new p(t,e||t.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||void 0);function c(t,r,a){var o=!0,i={left:10,right:0,top:5,bottom:5},l=e.dispatch("legendClick","legendDblclick","legendMouseover","legendMouseout");t=t||"svg",r=r||!1,a=a||[];var s="normal 12px sans-serif",c="black",u="bold 12px sans-serif",p="black";return{set target(e){t=e},get target(){return t},set title(t){r=t},get title(){return r},set series(t){a=t},get series(){return a},set margin(t){i=t},get margin(){return i},set dispatch(t){l=t},get dispatch(){return l},set interactive(t){o=t},get interactive(){return o},set labelFont(t){s=t},get labelFont(){return s},set labelColor(t){c=t},get labelColor(){return c},set titleFont(t){u=t},get titleFont(){return u},set titleColor(t){p=t},get titleColor(){return p},addSeries:function(t){t.key in Object.keys(a)||a.push(t)},getLegendStatus:function(){return a.map(function(t){return{key:t.key,status:t._status||!0}})},destroy:function(){e.select(".g3-legend").selectAll("*").remove()},draw:function(){a.forEach(t=>t._status=!0);let d=e.select(t),f=+d.attr("width"),m=+d.attr("height"),g=f-(i.left||0)-(i.right||0),h=d.append("g").attr("class","g3-legend").attr("transform","translate("+i.left+","+(m+i.top)+")"),b=r?n(r,u):0,y=Math.min(b+6,1/3*g),x=g-y,v={x:0,y:8},w={x:0,y:8};r&&h.append("g").attr("class","g3-legend-title").append("text").attr("x",y-6).attr("y",8).attr("text-anchor","end").attr("fill",p).style("font",u).attr("dy","0.35em").text(r);h.append("g").attr("class","g3-legend-item-container").attr("transform","translate("+y+", 0)").selectAll(".g3-legend-item").data(a).enter().append("g").attr("class","g3 g3-legend-item").style("cursor",o?"pointer":"default").each(function(t){let r=e.select(this),a=t.value.label||t.key;var i;i=n(a,s),(i+=23)>x-w.x?(v.x=0,v.y=w.y+16,w.x=i,w.y=v.y):(v.x=w.x,w.x+=i);let u=v.x+12+3,p=v.y;r.attr("state","enabled").attr("defaultColor",t.value.fill),r.append("circle").attr("cx",u).attr("cy",p).attr("r",3).attr("fill",t.value.fill||"transparent").attr("stroke-width",1).attr("stroke","grey"),u+=8,r.append("text").attr("x",u).attr("y",p).attr("text-anchor","start").attr("fill",c).style("font",s).attr("dy","0.35em").text(a),r.on("click",function(){var e,n,a,i;o&&(n=(e=r).attr("defaultColor"),a=e.select("circle"),i=e.select("text"),"enabled"==e.attr("state")?(e.attr("state","disabled"),a.attr("fill","transparent").attr("stroke",n),i.style("opacity",.5)):(e.attr("state","enabled"),a.attr("fill",n).attr("stroke","grey"),i.style("opacity",1)),l.call("legendClick",this,t.key,"enabled"==r.attr("state")),t._status="enabled"==r.attr("state"))})}),d.attr("height",m+i.top+v.y+8+i.bottom)}}}function u(){var t=function(){return"n"},n=function(){return[0,0]},r=function(){return" "},a=document.body,o=d(),i=null,l=null,s=null;function c(t){var e;e=t.node(),(i=e?"svg"===e.tagName.toLowerCase()?e:e.ownerSVGElement:null)&&(l=i.createSVGPoint(),a.appendChild(o))}c.show=function(){var e=Array.prototype.slice.call(arguments);e[e.length-1]instanceof SVGElement&&(s=e.pop());var o,i=r.apply(this,e),l=n.apply(this,e),d=t.apply(this,e),m=f(),g=p.length,h=document.documentElement.scrollTop||a.scrollTop,b=document.documentElement.scrollLeft||a.scrollLeft;for(m.html(i).style("opacity",1).style("pointer-events","all");g--;)m.classed(p[g],!1);return o=u.get(d).apply(this),m.classed(d,!0).style("top",o.top+l[0]+h+"px").style("left",o.left+l[1]+b+"px"),c},c.hide=function(){return f().style("opacity",0).style("pointer-events","none"),c},c.attr=function(t,n){if(arguments.length<2&&"string"==typeof t)return f().attr(t);var r=Array.prototype.slice.call(arguments);return e.selection.prototype.attr.apply(f(),r),c},c.style=function(t,n){if(arguments.length<2&&"string"==typeof t)return f().style(t);var r=Array.prototype.slice.call(arguments);return e.selection.prototype.style.apply(f(),r),c},c.direction=function(e){return arguments.length?(t=null==e?e:g(e),c):t},c.offset=function(t){return arguments.length?(n=null==t?t:g(t),c):n},c.html=function(t){return arguments.length?(r=null==t?t:g(t),c):r},c.rootElement=function(t){return arguments.length?(a=null==t?t:g(t),c):a},c.destroy=function(){return o&&(f().remove(),o=null),c};var u=e.map({n:function(){var t=m(this);return{top:t.n.y-o.offsetHeight,left:t.n.x-o.offsetWidth/2}},s:function(){var t=m(this);return{top:t.s.y,left:t.s.x-o.offsetWidth/2}},e:function(){var t=m(this);return{top:t.e.y-o.offsetHeight/2,left:t.e.x}},w:function(){var t=m(this);return{top:t.w.y-o.offsetHeight/2,left:t.w.x-o.offsetWidth}},nw:function(){var t=m(this);return{top:t.nw.y-o.offsetHeight,left:t.nw.x-o.offsetWidth}},ne:function(){var t=m(this);return{top:t.ne.y-o.offsetHeight,left:t.ne.x}},sw:function(){var t=m(this);return{top:t.sw.y,left:t.sw.x-o.offsetWidth}},se:function(){var t=m(this);return{top:t.se.y,left:t.se.x}}}),p=u.keys();function d(){var t=e.select(document.createElement("div"));return t.style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),t.node()}function f(){return null==o&&(o=d(),a.appendChild(o)),e.select(o)}function m(t){for(var n=s||e.event.target;null==n.getScreenCTM&&null!=n.parentNode;)n=n.parentNode;var r={},a=n.getScreenCTM(),o=n.getBBox(),i=o.width,c=o.height,u=o.x,p=o.y;return l.x=u,l.y=p,r.nw=l.matrixTransform(a),l.x+=i,r.ne=l.matrixTransform(a),l.y+=c,r.se=l.matrixTransform(a),l.x-=i,r.sw=l.matrixTransform(a),l.y-=c/2,r.w=l.matrixTransform(a),l.x+=i,r.e=l.matrixTransform(a),l.x-=i/2,l.y-=c/2,r.n=l.matrixTransform(a),l.y+=c,r.s=l.matrixTransform(a),r}function g(t){return"function"==typeof t?t:function(){return t}}return c}t.getTextWidth=n,t.getUniqueID=r,t.palettes=a,t.defaultPalette=o,t.getPalette=i,t.listPalettes=function(){return Object.keys(a)},t.scaleOrdinal=l,t.output=function(){function t(t,e){return(t=t||n)+"."+e}function e(t){t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),function(t,e){var n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML=t;var r=e.hasChildNodes()?e.children[0]:null;e.insertBefore(n,r)}(function(t){var e=[];e.push("#"+t.id);for(let n=0;n<t.classList.length;n++)c("."+t.classList[n],e)||e.push("."+t.classList[n]);var n=t.getElementsByTagName("*");for(let t=0;t<n.length;t++){var r=n[t].id;c("#"+r,e)||e.push("#"+r);var a=n[t].classList;for(let t=0;t<a.length;t++)c("."+a[t],e)||e.push("."+a[t])}var o="";for(let t=0;t<document.styleSheets.length;t++){var i=document.styleSheets[t];try{if(!i.cssRules)continue}catch(t){if("SecurityError"!==t.name)throw t;continue}for(var l=i.cssRules,s=0;s<l.length;s++)c(l[s].selectorText,e)&&(o+=l[s].cssText)}return o;function c(t,e){return-1!==e.indexOf(t)}}(t),t);var e=(new XMLSerializer).serializeToString(t);return e=(e=e.replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href")}var n="output",r="svg";function a(t){r=t||r}return a.toSVG=function(n){n=t(n,"svg");var a=e(document.querySelector(r)),o=new Blob([a],{type:"image/svg+xml"});s(o,n)},a.toPNG=function(n){n=t(n,"png");var a=document.querySelector(r),o=+a.getAttribute("width"),i=+a.getAttribute("height"),l=e(a),c="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(l))),u=document.createElement("canvas");u.width=o,u.height=i;var p=u.getContext("2d"),d=new Image;d.src=c,d.onload=function(){p.clearRect(0,0,o,i),p.drawImage(d,0,0,o,i),u.toBlob(function(t){s(t,n)})}},a},t.legend=c,t.tooltip=u,t.Lollipop=function(t,a,o){const i="g3_lollipop",s={circle:0,pie:1},p={x:"AA_Position",y:"Protein_Change",factor:"Mutation_Class"},d={symbol:"hgnc_symbol",name:"protein_name",length:"length",domainType:"pfam",details:{start:"pfam_start",end:"pfam_end",ac:"pfam_ac",name:"pfam_id"}};t=t||"svg",o=o||800,(a=a||"circle")in s||(a="circle");var f,m,g,h,b,y,x,v,w,k,C,S,T,L,A,_,D,E,N,F,B,M,P,z,O,I,R,j,H,W,U,V,$=r(),q={chartID:i+"_"+$,className:"g3-chart",tooltip:!0,margin:{left:40,right:20,top:15,bottom:25},background:"transparent",transitionTime:600,legend:!0,legendOpt:{margin:{},interactive:!0,title:"__undefined__"}},G={id:i+"-main-"+$,defsId:i+"-main-defs-"+$,height:420,background:"rgb(244,244,244)",lollipopClassName:{group:"lollipop",line:"lollipopLine",pop:"pop"},lollipopLine:{stroke:"rgb(42,42,42)","stroke-width":.5},popClassName:{pie:"popPie",slice:"pieSlice",text:"popText",circle:"popCircle",label:"popLabel"},popCircle:{stroke:"wheat","stroke-width":.5},popText:{fill:"#EEE","font-family":"Sans","font-weight":"normal","text-anchor":"middle",dy:"0.35em"},popLabel:{"font-family":"Arial","font-weight":"normal",minFontSize:10,fontsizeToRadius:1.4,padding:5},popColorScheme:l("accent"),yPaddingRatio:1.1,popParams:{rMin:2,rMax:12,addNumRCutoff:8,yLowerQuantile:.25,yUpperQuantile:.99},title:{id:"g3-chart-title",text:"",font:"normal 16px Arial",color:"#424242",alignment:"middle",dy:"0.35em"},axisLabel:{font:"normal 12px Arial",fill:"#4f4f4f","text-anchor":"middle",dy:"-2em",alignment:"middle"},ylab:{text:"mutations"}},Y={id:i+"-domain-"+$,defsId:i+"-annotation-defs-"+$,height:30,margin:{top:4,bottom:0},background:"transparent",className:{track:"domain_track",bar:"domain_bar",domain:i+"_domain",brush:"domain-x-brush",zoom:"main-viz-zoom"},domain:{colorScheme:l("category10"),margin:{top:0,bottom:0},label:{font:"normal 11px Arial",color:"#f2f2f2"}},bar:{background:"#e5e3e1",margin:{top:2,bottom:2}},brush:!0,zoom:!0},X=[],Q={},J=p,K=d,Z=!1,tt=[],et=null,nt=!1,rt=!1,at={},ot=function(t){return lt(t)-it(t)},it=function(t){return L(t[K.details.start])},lt=function(t){return L(t[K.details.end])},st=function(){L.domain(T),D.call(A),k.attr("x",function(t){return it(t)}).attr("width",function(t){return ot(t)}),C.attr("x",function(t){return(it(t)+lt(t))/2}),y.attr("x1",function(t){return ut(t)}).attr("x2",function(t){return ut(t)}),x.attr("transform",function(t){return"translate("+ut(t)+","+pt(t)+")"})},ct=function(){if(e.event.sourceEvent&&"zoom"===e.event.sourceEvent.type)return;let t=e.event.selection||O.range();T=t.map(O.invert),Y.zoom&&g.select(".main-viz-zoom").call(I.transform,e.zoomIdentity.scale(W/(t[1]-t[0])).translate(-t[0],0)),st()},ut=function(t){return L(t.position)},pt=function(t){return N(t._currentState.count)},dt=function(t){let e=t._currentState.count;return 0==e?0:e>=v?G.popParams.rMax:e<=w?G.popParams.rMin:(e-w)/(v-w)*(G.popParams.rMax-G.popParams.rMin)+G.popParams.rMin},ft=function(t){let n="";return rt?(n+=`<div class="note">\n            <table class="pure-table pure-table-bordered">\n                <caption> Position ${t.position} </caption>\n                <thead>\n                    <tr>\n                        <th scope="col">Class</th>\n                        <th scope="col">#</th>\n                        <th scope="col">Change</th>\n                        <th scope="col">&#37;</th>\n                    </tr>\n                </thead>\n                <tbody>`,t._currentState.summary.forEach(function(r){r.value.count>0&&(n+=`\n                    <tr>\n                        <th scope="row"> ${r.key} </th>\n                        <td> ${r.value.count} </td>\n                        <td>`+mt(r.value.byY)+"</td>\n                        <td>"+e.format(".1f")(r.value.count/t._currentState.count*100)+"&#37;</td>\n                    </tr>")}),n+="\n                </tbody>\n            </table></div>"):(n+=`\n            <table class="pure-table pure-table-bordered">\n                <caption> Position ${t.position} </caption>\n                <thead>\n                    <tr>\n                        <th scope="col">Change</th>\n                        <th scope="col">&#37;</th>\n                    </tr>\n                </thead>\n                <tbody>`,t._currentState.summary[0].value.byY.forEach(function(r){n+=`\n                    <tr>\n                        <th> ${r.key} </th>\n                        <td>`+e.format(".1f")(r.value/t._currentState.count*100)+"&#37;</td>\n                    </tr>"}),n+="\n                </tbody>\n            </table>"),n},mt=function(t){var e="";return t.forEach(function(t){e+=`${t.key} (n=${t.value})<br>`}),e},gt=function(t,e){q.tooltip&&et.show(t,e)},ht=function(t){q.tooltip&&et.hide(t)},bt=function(t){let e,n,r,a=-1;return t._currentState.summary.forEach(function(t){t.value.count>0&&t.value.count>a&&(e=t.value.byY[0].key,r=t,n=G.popColorScheme(t.key),a=t.value.count)}),{class:r,entry:e,count:a,color:n}},yt=function(t,e){if(t._currentState.showLabel){t._currentState.showLabel=!1;let n=e.select("."+G.popClassName.label);Et(n.attr("yMaxValue"),-1),n.transition().duration(q.transitionTime).attr("transform","rotate(0)").remove()}else{t._currentState.showLabel=!0;let r=bt(t),a=Math.max(t._currentState.radius*G.popLabel.fontsizeToRadius,G.popLabel.minFontSize)+"px",o=G.popLabel["font-weight"]+" "+a+" "+G.popLabel["font-family"],i=n(r.entry,o),l=t._currentState.radius+G.popLabel.padding+i,s=(E[1]-E[0])*(l/H),c=t._currentState.count+s;Et(c,1),e.append("text").classed(G.popClassName.label,!0).attr("x",-t._currentState.radius-G.popLabel.padding).attr("y",0).attr("yMaxValue",c).text(r.entry).style("fill",r.color).style("font",o).attr("dy",".35em").attr("text-anchor","end").transition().duration(q.transitionTime).attr("transform","rotate(90)")}},xt=function(){return e.pie().sort(null)},vt=function(t){let n=e.select(this);t._currentState.showLabel&&(n.select("."+G.popClassName.label).remove(),t._currentState.showLabel=!1);let r=t._currentState.radius=dt(t);switch(a){case"pie":!function(t,n,r){let a=e.arc().innerRadius(0).outerRadius(r),o=xt().value(function(t){return t.value.count}),i=n.select("."+G.popClassName.pie).selectAll("path."+G.popClassName.slice).data(o(t._currentState.summary));i.enter().insert("path"),i.transition().duration(q.transitionTime).attrTween("d",function(t){this._current=this._current||t;let n=e.interpolate(this._current,t);return this._current=n(0),function(t){return a(n(t))}}),i.exit().remove()}(t,n,r);break;default:!function(t,e,n){let r=e.select("."+G.popClassName.circle),a=bt(t).color||"transparent";r.transition().duration(q.transitionTime).attr("r",n).attr("fill",a)}(t,n,r)}let o=n.select("."+G.popClassName.text);if(r>=G.popParams.addNumRCutoff){let e=wt(r,t._currentState.count,G.popText["font-weight"],G.popText["font-family"]),n=G.popText["font-weight"]+" "+e+" "+G.popText["font-family"];o.transition().duration(q.transitionTime).text(t._currentState.count).style("font",n)}else o.text("")},wt=function(t,e,r,a){let o=1.75*t;for(let t=Math.ceil(o);t>=0;t--)if(n(e,r+" "+t+"px "+a)<=o)return t+"px";return 0},kt=function(t){let n=e.select(this),r=t._currentState.radius=dt(t);n.append("circle").attr("class",G.popClassName.circle).attr("cx",0).attr("cy",0).attr("r",r).attr("stroke",G.popCircle.stroke).attr("stroke-width",G.popCircle["stroke-width"]).attr("fill","none");let a=e.arc().innerRadius(0).outerRadius(r),o=xt().value(function(t){return t.value.count}),i=n.append("g").attr("class",G.popClassName.pie);i.selectAll(G.popClassName.slice).data(o(t._currentState.summary)).enter().append("path").attr("d",a).attr("class",G.popClassName.slice).attr("fill",function(t){return G.popColorScheme(t.data.key)}),i.exit().remove();let l=n.append("text").attr("class",G.popClassName.text).attr("fill",G.popText.fill).style("font-family",G.popText["font-family"]).style("font-weight",G.popText["font-weight"]).attr("text-anchor",G.popText["text-anchor"]).attr("dy",G.popText.dy);if(r>=G.popParams.addNumRCutoff){let e=wt(r,t._currentState.count,G.popText["font-weight"],G.popText["font-family"]);l.transition().duration(q.transitionTime).text(t._currentState.count).style("font-size",e)}else l.text("");n.on("mouseover",function(t){gt(t)}).on("mouseout",function(t){ht(t)}).on("click",function(t){yt(t,n)})},Ct=function(t){let n=e.select(this),r=t._currentState.radius=dt(t),a=bt(t);n.append("circle").attr("class",G.popClassName.circle).attr("cx",0).attr("cy",0).attr("r",r).attr("stroke",G.popCircle.stroke).attr("stroke-width",G.popCircle["stroke-width"]).attr("fill",a.color);let o=n.append("text").attr("class",G.popClassName.text).style("font-family",G.popText["font-family"]).style("font-weight",G.popText["font-weight"]).attr("text-anchor",G.popText["text-anchor"]).attr("dy",G.popText.dy);if(r>=G.popParams.addNumRCutoff){let e=wt(r,t._currentState.count,G.popText["font-weight"],G.popText["font-family"]);o.transition().duration(q.transitionTime).text(t._currentState.count).attr("font-size",e)}else o.text("");n.on("mouseover",function(t){gt(t)}).on("mouseout",function(t){ht(t)}).on("click",function(t){yt(t,n)})},St=function(){switch(b=g.append("g").attr("class",G.lollipopClassName.group),y=b.append("g").attr("clip-path","url(#"+G.defsId+")").selectAll(G.lollipopClassName.line).data(X).enter().append("line").attr("x1",function(t){return ut(t)}).attr("x2",function(t){return ut(t)}).attr("y1",N(0)+Y.margin.top).attr("y2",function(t){return pt(t)}).attr("class",G.lollipopClassName.line).attr("stroke",G.lollipopLine.stroke).attr("stroke-width",G.lollipopLine["stroke-width"]),x=b.append("g").attr("clip-path","url(#"+G.defsId+")").selectAll(G.lollipopClassName.pop).data(X).enter().append("g").attr("transform",function(t){return"translate("+ut(t)+","+pt(t)+")"}).classed(G.lollipopClassName.pop,!0).attr("id",function(t,e){return i+"-"+$+"-lollipop-group-"+e}),a){case"pie":x.each(kt);break;default:x.each(Ct)}let t,e,n;G.title.text.length>0&&("start"==G.title.alignment?(t="start",e=0):"middle"==G.title.alignment?(t="middle",e=W/2):(t="end",e=W),n=-q.margin.top/2,g.append("text").attr("id",G.title.id).style("font",G.title.font).attr("fill",G.title.color).attr("text-anchor",t).attr("alignment-base","alphabetic").attr("transform","translate("+e+","+n+")").attr("dy",G.title.dy).text(G.title.text))},Tt=function(){if(e.event.sourceEvent&&"brush"===e.event.sourceEvent.type)return;let t=e.event.transform;T=t.rescaleX(O).domain(),Y.brush&&h.select("."+Y.className.brush).call(z.move,O.range().map(t.invertX,t)),st()},Lt=function(){if(!J.hasOwnProperty("x")||!J.hasOwnProperty("y"))throw"No X or Y columns specified in data set";Z||(at=e.nest().key(t=>t[J.factor]).rollup(function(t){return+t.length}).object(X),(X=e.nest().key(t=>+t[J.x]).entries(X).sort((t,e)=>t.key-e.key)).forEach(function(t){t.position=+t.key,delete t.key,t.total=+t.values.length})),X.forEach(function(t){let n=e.nest().key(function(t){return t[J.factor]}).rollup(function(t){let n=t.filter(function(t){return t[J.factor]in at});return{count:+n.length,byY:e.nest().key(function(t){return t[J.y]}).rollup(function(t){return+t.length}).entries(n).sort(function(t,e){return e.value-t.value})}}).entries(t.values).sort(function(t,e){return t.key>e.key});Z||(t._currentState={},t._currentState.showLabel=!1),t._currentState.count=e.sum(n.map(function(t){return t.value.count})),t._currentState.summary=n}),Z=!0,B=X.map(function(t){return+t._currentState.count}).filter(function(t){return t>0}).sort(function(t,e){return t-e}),w=Math.ceil(e.quantile(B,G.popParams.yLowerQuantile)),v=Math.floor(e.quantile(B,G.popParams.yUpperQuantile)),tt=[]},At=function(t){return e.scaleLinear().domain([0,t]).range([H,0]).nice().domain()[1]},_t=function(){E=0==B.length?[0,1]:e.extent(B),S=E[1]=At(E[1]*G.yPaddingRatio)},Dt=function(){_t(),N=e.scaleLinear().domain(E).range([H,0]),F=e.axisLeft(N).tickSize(-W).ticks(9),T=[0,Q.length],L=e.scaleLinear().domain(T).range([0,j]),O=e.scaleLinear().domain(T).range([0,j]),_=function(t,e){if(void 0===e||t.length<=1||t[t.length-1]>=e)return t;var n=Math.abs(t[1]-t[0]);return Math.abs(e-t[t.length-1])>n/2?t.push(e):t[t.length-1]=e,t}(L.ticks(),Q.length),A=e.axisBottom(L).tickValues(_).tickFormat(function(t){return this.parentNode.nextSibling?t:t+" aa"})},Et=function(t,e){if(1!=(e=e||1)&&-1!=e&&(e=1),t=At(t*G.yPaddingRatio),t=Math.max(S,t),1===e)tt.push(t),tt=tt.sort();else{let e=tt.indexOf(t);-1!=e&&(tt=tt.slice(0,e).concat(tt.slice(e+1)))}let n=0==tt.length?S:tt[tt.length-1];n!=E[1]&&(E[1]=n,Nt())},Nt=function(){N.domain(E),M.transition().duration(q.transitionTime).call(Ft),y.transition().duration(q.transitionTime).attr("y2",function(t){return pt(t)}),x.transition().duration(q.transitionTime).attr("transform",function(t){return"translate("+ut(t)+","+pt(t)+")"})},Ft=function(t){var e=t.selection?t.selection():t;t.call(F),e.select(".domain").remove(),e.selectAll(".tick line").filter(Number).attr("stroke","#aaa").attr("stroke-dasharray","2,2"),e.selectAll(".tick text").attr("x",-2).attr("dy",2),e!==t&&t.selectAll(".tick text").attrTween("x",null).attrTween("dy",null)},Bt=function(t,e,n,r){t.append("g").attr("id","background-layer").append("rect").attr("x",0).attr("y",0).attr("width",r).attr("height",n).attr("fill",e)},Mt=function(){(f=e.select(t).attr("width",V).attr("height",U).attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink")).classed(q.className,!0).style("background-color",q.background||"transparent"),m=f.append("g").attr("transform","translate("+q.margin.left+","+q.margin.top+")").attr("id",q.chartID),g=m.append("g").attr("id",G.id),Bt(g,G.background,H,W),h=m.append("g").attr("id",Y.id).attr("transform","translate(0, "+(H+Y.margin.top)+")"),Bt(h,Y.background,R,j),q.tooltip&&(et=u().attr("class","d3-tip").offset([8,0]).direction(function(t){return t.count>E[1]/2?"s":"n"}).offset(function(t){return t.count>E[1]/2?[16,0]:[-12,0]}).html(ft),g.call(et))},Pt={};return Pt.options={set target(e){t=e},get target(){return t},set width(t){o=t},get width(){return o},set chartType(t){t&&t in s&&(a=t)},get chartType(){return a},get chartID(){return q.chartID},set margin(t){q.margin=t},get margin(){return q.margin},set background(t){q.background=t},get background(){return q.background},set transitionTime(t){q.transitionTime=t},get transitionTime(){return q.transitionTime},set tooltip(t){q.tooltip=t},get tooltip(){return q.tooltip},set ylab(t){G.ylab.text=t},get ylab(){return G.ylab.text},set axisLabelFont(t){G.axisLabel.font=t},get axisLabelFont(){return G.axisLabel.font},set axisLabelColor(t){G.axisLabel.fill=t},get axisLabelColor(){return G.axisLabel.fill},set axisLabelAlignment(t){G.axisLabel.alignment=t},get axisLabelAlignment(){return G.axisLabel.alignment},set axisLabelDy(t){G.axisLabel.dy=t},get axisLabelDy(){return G.axisLabel.dy},set showLegend(t){q.legend=t},get showLegend(){return q.legend},set legendMargin(t){q.legendOpt.margin=t},get legendMargin(){return q.legendOpt.margin},set legendInteractive(t){q.legendOpt.interactive=t},get legendInteractive(){return q.legendOpt.interactive},set legendTitle(t){q.legendOpt.title=t},get legendTitle(){return q.legendOpt.title},get lollipopTrackID(){return G.id},set lollipopTrackHeight(t){G.height=t},get lollipopTrackHeight(){return G.height},set lollipopTrackBackground(t){G.background=t},get lollipopTrackBackground(){return G.background},set lollipopPopMinSize(t){G.popParams.rMin=t},get lollipopPopMinSize(){return G.popParams.rMin},set lollipopPopMaxSize(t){G.popParams.rMax=t},get lollipopPopMaxSize(){return G.popParams.rMax},set lollipopPopInfoLimit(t){G.popParams.addNumRCutoff=t},get lollipopPopInfoLimit(){return G.popParams.addNumRCutoff},set lollipopPopInfoColor(t){G.popText.fill=t},get lollipopPopInfoColor(){return G.popText.fill},set lollipopLineColor(t){G.lollipopLine.stroke=t},get lollipopLineColor(){return G.lollipopLine.stroke},set lollipopLineWidth(t){G.lollipopLine["stroke-width"]=t},get lollipopLineWidth(){return G.lollipopLine["stroke-width"]},set lollipopCircleColor(t){G.popCircle.stroke=t},get lollipopCircleColor(){return G.popCircle.stroke},set lollipopCircleWidth(t){G.popCircle["stroke-width"]=t},get lollipopCircleWidth(){return G.popCircle["stroke-width"]},set lollipopLabelRatio(t){G.popLabel.fontsizeToRadius=t},get lollipopLabelRatio(){return G.popLabel.fontsizeToRadius},set lollipopLabelMinFontSize(t){G.popLabel.minFontSize=t},get lollipopLabelMinFontSize(){return G.popLabel.minFontSize},set lollipopColorScheme(t){G.popColorScheme=t},get lollipopColorScheme(){return G.popColorScheme},set titleText(t){G.title.text=t},get titleText(){return G.title.text},set titleFont(t){G.title.font=t},get titleFont(){return G.title.font},set titleColor(t){G.title.color=t},get titleColor(){return G.title.color},set titleAlignment(t){G.title.alignment=t},get titleAlignment(){return G.title.alignment},set titleDy(t){G.title.dy=t},get titleY(){return G.title.dy},get annoID(){return Y.id},set annoHeight(t){Y.height=t},get annoHeight(){return Y.height},set annoMargin(t){Y.margin=t},get annoMargin(){return Y.margin},set annoBackground(t){Y.background=t},get annoBackground(){return Y.background},set annoBarFill(t){Y.bar.background=t},get annoBarFill(){return Y.bar.background},set annoBarMargin(t){Y.bar.margin=t},get annoBarMargin(){return Y.bar.margin},set domainColorScheme(t){Y.domain.colorScheme=t},get domainColorScheme(){return Y.domain.colorScheme},set domainMargin(t){Y.domain.margin=t},get domainMargin(){return Y.domain.margin},set domainTextFont(t){Y.domain.label.font=t},get domainTextFont(){return Y.domain.label.font},set domainTextColor(t){Y.domain.label.color=t},get domainTextColor(){return Y.domain.label.color},set brush(t){Y.brush=t},get brush(){return Y.brush},set zoom(t){Y.zoom=t},get zoom(){return Y.zoom}},Pt.setOptions=function(t){for(let e in t)this.options[e]=t[e]},Pt.getOptions=function(t){let e={},n=this;return t.forEach(function(t){n.options[t]&&(e[t]=n.options[t])}),e},Pt.destroy=function(){(f=e.select(t)).attr("width",null).attr("height",null).attr("xmlns",null).attr("xmlns:xlink",null).classed(q.className,!1).style("background-color",null),f.selectAll("*").remove(),q.tooltip&&nt&&et.destroy()},Pt.refresh=function(){this.destroy(),this.draw(J,K)},Pt.data={set snvData(t){X=t},get snvData(){return X},set domainData(t){Q=t},get domainData(){return Q}},Pt.draw=function(n,r){K=r||d,(J=n||p).hasOwnProperty("factor")?rt=!0:(rt=!1,J.factor="__undefined__",X.forEach(function(t){t[J.factor]="__undefined__"})),U=G.height+Y.height,V=o,H=G.height-q.margin.top-q.margin.bottom,W=V-q.margin.left-q.margin.right,R=Y.height-Y.margin.top-Y.margin.bottom,j=W,Lt(),Mt(),function(){let t,e;Dt(),M=g.append("g").attr("class","axis axis--y").call(Ft),"start"==G.axisLabel.alignment?(t="end",e=0):"middle"==G.axisLabel.alignment?(t="middle",e=H/2):(t="start",e=H),g.append("text").attr("class","yaxis axis-label").attr("transform","translate(0,"+e+")rotate(-90)").style("font",G.axisLabel.font).attr("fill",G.axisLabel.fill).attr("text-anchor",t).attr("alignment-base","middle").attr("dy",G.axisLabel.dy).text(G.ylab.text),D=g.append("g").attr("class","axis axis--x").attr("transform","translate(0, "+(H+Y.height)+")").call(A)}(),g.append("defs").append("clipPath").attr("id",G.defsId).append("rect").attr("width",W).attr("height",H+Y.margin.top),h.append("defs").append("clipPath").attr("id",Y.defsId).append("rect").attr("width",j).attr("height",R),function(){let t=R-Y.bar.margin.top-Y.bar.margin.bottom;h.append("rect").classed(Y.className.bar,!0).attr("x",0).attr("y",Y.bar.margin.top).attr("width",j).attr("height",t).attr("fill",Y.bar.background);let n=R-Y.domain.margin.top-Y.domain.margin.bottom,r=h.append("g").attr("class",Y.className.track).selectAll(Y.className.domain).data(Q[K.domainType]).enter().append("g").attr("clip-path","url(#"+Y.defsId+")").attr("class",Y.className.domain);k=r.append("rect").attr("x",function(t){return it(t)}).attr("y",Y.domain.margin.top).attr("height",n).attr("width",function(t){return ot(t)}).attr("fill",function(t){return Y.domain.colorScheme(t[K.details.name])}),C=r.append("text").attr("x",function(t){return(it(t)+lt(t))/2}).attr("y",Y.domain.margin.top+n/2).attr("dy","0.35em").attr("text-anchor","middle").attr("fill",Y.domain.label.color||"white").style("font",Y.domain.label.font).text(function(t){return t[K.details.name]}),Y.brush&&(z=e.brushX().extent([[0,0],[j,R]]).on("brush end",ct)),Y.zoom&&(I=e.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[W,H]]).extent([[0,0],[W,H]]).on("zoom",Tt)),Y.brush&&h.append("g").attr("class",Y.className.brush).call(z),Y.zoom&&g.append("rect").attr("class",Y.className.zoom).attr("width",W).attr("height",H).attr("fill","none").attr("cursor","move").attr("pointer-events","all").call(I)}(),St(),q.legend&&function(){if(q.legend){P=new c(t),0==Object.keys(q.legendOpt.margin).length&&(q.legendOpt.margin={left:q.margin.left,right:q.margin.right,top:2,bottom:2}),P.margin=q.legendOpt.margin,P.interactive=q.legendOpt.interactive,P.title="__undefined__"===q.legendOpt.title?J.factor:q.legendOpt.title;for(let t in at)P.addSeries({key:t,value:{fill:G.popColorScheme(t),label:t+" ("+at[t]+")"}});P.dispatch.on("legendClick",function(t,e){e?at[t]=e:delete at[t],Lt(),_t(),Nt(),x.each(vt)}),P.draw()}}(),Y.brush&&h.select(".domain-x-brush").call(z.move,[0,j]),nt=!0},Pt},Object.defineProperty(t,"__esModule",{value:!0})});