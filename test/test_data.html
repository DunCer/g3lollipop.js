<!DOCTYPE html>
<html>

<head>
  <link rel="shortcut icon" href="../favicon.ico">
  <link rel="stylesheet" media="screen" href="../css/style.min.css" />
  <style>
    .warp {
      margin-left: 40px;
    }

    #svg-panel {
      border: 2px solid black;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div id="ctrl-panel">
      <span class="btn-group">
        <button id="save-as-png">Save PNG</button>
        <button id="save-as-svg">Save SVG</button>
        <button id="next">Start</button>
      </span>
    </div>

    <div class="console" id="info">
    </div>

    <div id="plot-panel">
      <svg id="svg-panel">
      </svg>
    </div>
  </div>

  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="../dist/g3-lollipop.min.js"></script>
  <script>
    function csv2json(tsv, sep, header) {
      sep = sep || "\t";

      if (header == undefined || header == null) {
        header = true;
      }

      var result = [],
        headers = [];
      var lines = tsv.split("\n");
      if (lines[lines.length - 1] == "") {
        lines.pop();
      }

      if (header) {
        headers = lines[0].split(sep);
        lines.shift();
      }

      for (var i = 0; i < lines.length; i++) {
        var obj = {};
        var curLine = lines[i].split(sep);

        if (header) {
          for (var j = 0; j < headers.length; j++) {
            obj[headers[j]] = curLine[j] || "";
          }
        } else {
          for (var j = 0; j < curLine.length; j++) {
            obj["V" + j] = curLine[j];
          }
        }

        result.push(obj);
      }

      return JSON.stringify(result);
    }

    function uniprot(symbol, callback) {
      var url = "https://www.uniprot.org/uniprot/?query=gene_exact:" +
        symbol +
        "+AND+organism:9606+AND+reviewed:yes\&columns=id,length\&format=tab";

      fetch(url, {
          cache: 'default', // *default, no-cache, reload, force-cache, only-if-cached
          method: 'GET',
          "Content-type": "text/plain",
        })
        .then(function (res) {
          if (res.status == 200) {
            return res.text();
          } else {
            console.log("something error code [" + res.status + "]");
            return "";
          }
        })
        .then(function (text) {
          return callback? callback(csv2json(text)) : csv2json(text);
        })
    }

    function uniprot2(symbol){
    }

    var _symbol = "tp53";

    d3.queue()
      .defer(uniprot, _symbol)
      .await(function (error, json) {
        if (error) throw error;
        console.log("here");
        console.log(json);
      });
  </script>
</body>

</html>